<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Lucas</title>
<!-- <script type="text/javascript" src="https://d.line-scdn.net/liff/1.0/sdk.js"></script> -->
<script type="text/javascript" src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
<style>
* {
  font-family: '微軟黑體';
}
html, body {
  text-align: center;
  width: 100%;
  height: 100%;
  padding: 0;
  margin: 0;
}
.test-box {
  display: flex;
}
button {
  flex: 1 1 0;
  padding: 3rem;
  font-size: 3rem;
  color: rgb(122, 122, 122);
  border: 1px solid rgb(216, 200, 200);
  border-radius: 0;
}

.aLink {
  font-size: 26px;
  display: inline-block;
  margin: 30px;
}

#lookInfoBox {
  border: 1px solid yellow;
  padding: 10px;
}
#result {
  border: 1px solid blue;
  padding: 10px;
}

</style>
</head>
<body onload="onload()">
  <div class="test-box ">
    <button onclick="testCall()">測試傳送訊息</button>
    <button onclick="testCall('請問報價')">傳送詢問報價訊息</button>
    <button onclick="testClose()">測試關閉</button>
  </div>

  <div id="lookInfoBox"></div>

  <div id="result"></div>
  
  <div class="aLink"></div>

<script>
var lineUserData = null;
$lookInfoBox = document.getElementById('lookInfoBox');

//透過 liff 發話
function testCall(_txt) {
  let txt = (_txt)? _txt : ("測試拿到的line user資料" + JSON.stringify(lineUserData));
	let msg = [{
		type: "text",
		text: txt
	}];
  //alert(msg);
	liff.sendMessages(msg).then(() => {
		alert('YA!訊息已送出.');
	}).catch((error) => {
		alert("Error getting profile: ");
		alert(JSON.stringify(error));
		liff.closeWindow();
	});
}

//透過 liff 關閉 webview
function testClose() {
	liff.closeWindow();
}


function onload() {
	if (liff) {
    liff.init({ liffId: '1633210473-BZ1zNNWk' }).then(() => {
      alert('liff...' + JSON.stringify(liff));
      let accessToken = liff.getAccessToken();
      let info = '';
      info = info + 'getLanguage: ' + liff.getLanguage() + ' \r\n, ';
      info = info + 'getVersion: ' + liff.getVersion() + ' \r\n, ';
      info = info + 'isInClient: ' + liff.isInClient() + ' \r\n, ';
      info = info + 'isLoggedIn: ' + liff.isLoggedIn() + ' \r\n, ';
      info = info + 'getOS: ' + liff.getOS() + ' \r\n, ';
      info = info + 'getAccessToken: ' + accessToken + ' \r\n, ';
      $lookInfoBox.innerHTML = info;

      //透過 token 取得使用者資訊
      fetch('https://api.line.me/v2/profile', {
        method: 'GET',
        headers: {
          'content-type': 'application/json',
          'Authorization': `Bearer ${accessToken}`
        },
      }).then(response => {
        return response.json();
      }).then((data) => {
        alert('fetch: ' + JSON.stringify(data));
        var result = document.getElementById('result');
        result.innerHTML +=
          'scope:' + data.scope + '<br>' +
          'client_id:' + data.client_id + '<br>' +
          'expires_in:' + data.expires_in + '<br>';
      });

    }).catch((error) => {
      alert('liff init error: ' + JSON.stringify(error));
    });


		/* liff.init((data) => {
			//alert(JSON.stringify('data: '));
			//alert(JSON.stringify(data));
			liff.getProfile().then((profile) => {
				//alert(JSON.stringify(profile));
				lineUserData = profile;

        $lookInfoBox.innerHTML = JSON.stringify(profile);

			}).catch((error) => {
				alert(JSON.stringify(error));
			});
		}, (eror) => {
			//alert(JSON.stringify(eror));
      console.log(eror);
		}); */
	}

  setTimeout(function () {
    var $a = document.createElement('A');
    $a.setAttribute('href', 'https://lucaschien.github.io/my_promote/liff.html');
    $a.innerHTML = "重新聯結網頁!";
    document.getElementsByClassName('aLink')[0].appendChild($a);
  }, 10000);

}
</script>
</body>
</html>